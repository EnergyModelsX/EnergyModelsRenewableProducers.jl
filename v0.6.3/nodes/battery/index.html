<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Battery · EnergyModelsRenewableProducers</title><meta name="title" content="Battery · EnergyModelsRenewableProducers"/><meta property="og:title" content="Battery · EnergyModelsRenewableProducers"/><meta property="twitter:title" content="Battery · EnergyModelsRenewableProducers"/><meta name="description" content="Documentation for EnergyModelsRenewableProducers."/><meta property="og:description" content="Documentation for EnergyModelsRenewableProducers."/><meta property="twitter:description" content="Documentation for EnergyModelsRenewableProducers."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnergyModelsRenewableProducers</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/quick-start/">Quick Start</a></li><li><a class="tocitem" href="../../manual/simple-example/">Examples</a></li><li><a class="tocitem" href="../../manual/NEWS/">Release notes</a></li></ul></li><li><span class="tocitem">Nodes</span><ul><li><a class="tocitem" href="../nondisres/">Non-dispatchable RES</a></li><li><a class="tocitem" href="../hydropower/">Simple Hydropower</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Detailed hydropower</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../det_hydropower/description/">Detailed hydropower</a></li><li><a class="tocitem" href="../det_hydropower/reservoir/">Hydro reservoir node</a></li><li><a class="tocitem" href="../det_hydropower/generator/">Hydro generator node</a></li><li><a class="tocitem" href="../det_hydropower/pump/">Hydro pump node</a></li><li><a class="tocitem" href="../det_hydropower/gate/">Hydro gate node</a></li></ul></li><li class="is-active"><a class="tocitem" href>Battery</a><ul class="internal"><li><a class="tocitem" href="#nodes-battery-phil"><span>Concepts used for Batteries</span></a></li><li><a class="tocitem" href="#nodes-battery-fields"><span>Introduced types and their fields</span></a></li><li><a class="tocitem" href="#nodes-battery-math"><span>Mathematical description</span></a></li></ul></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../how-to/update-models/">Update models</a></li><li><a class="tocitem" href="../../how-to/contribute/">Contribute to EnergyModelsRenewableProducers</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/internals/types-EMRP/">Types</a></li><li><a class="tocitem" href="../../library/internals/methods-fields/">Methods - Accessing fields</a></li><li><a class="tocitem" href="../../library/internals/methods-EMRP/">Methods - Internal</a></li><li><a class="tocitem" href="../../library/internals/methods-EMB/">Methods - <code>EnergyModelsBase</code></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Nodes</a></li><li class="is-active"><a href>Battery</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Battery</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsRenewableProducers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsRenewableProducers.jl/blob/main/docs/src/nodes/battery.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="nodes-battery"><a class="docs-heading-anchor" href="#nodes-battery">Hydro storage node</a><a id="nodes-battery-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery" title="Permalink"></a></h1><p>As outlined in the section on <em><a href="../hydropower/#nodes-hydro_power">simple hydro storage</a></em>, the reference storage node<a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> has some built in limitations. In the case of battery storage, the main limitations are related to not limiting the discharge use, not being able to include charge and discharge efficiencies, and not allowing for degradation of the storage capacity.</p><p>Hence, it is necessary to include specific battery nodes.</p><h2 id="nodes-battery-phil"><a class="docs-heading-anchor" href="#nodes-battery-phil">Concepts used for Batteries</a><a id="nodes-battery-phil-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-phil" title="Permalink"></a></h2><h3 id="nodes-battery-phil-life"><a class="docs-heading-anchor" href="#nodes-battery-phil-life">Battery lifetime</a><a id="nodes-battery-phil-life-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-phil-life" title="Permalink"></a></h3><p>Batteries experience storage capacity degradation. The degradation can be differentiated in 1. degradation through time and 2. degradation through charging and discharging the battery. Degradation through time is not included in the developed nodes. Instead, degradation through charging is included.</p><p>The lifetime is implemented through <a href="../../library/internals/types-EMRP/#EnergyModelsRenewableProducers.AbstractBatteryLife"><code>AbstractBatteryLife</code></a> types. There are two options implemented, <a href="../../library/public/#EnergyModelsRenewableProducers.InfLife"><code>InfLife</code></a> and <a href="../../library/public/#EnergyModelsRenewableProducers.CycleLife"><code>CycleLife</code></a>. <a href="../../library/public/#EnergyModelsRenewableProducers.InfLife"><code>InfLife</code></a> does not include any storage capacity degradation. The battery life is unlimited and unimpacted by the use of the battery. <a href="../../library/public/#EnergyModelsRenewableProducers.CycleLife"><code>CycleLife</code></a> includes both linear battery degradation and a lifetime through the maximum number of cycles of the battery. The linear degradation is dependent on the charging of the battery although this is equivalent to the discharging. The type allows for replacement of the battery stack to reduce battery degradation to 0 at the beginning of an investment period. The cost for replacement has to be accessible through a strategic period. Hence, it can be either a <code>FixedProfile</code> or a <code>StrategicProfile</code>, but cannot include, <em>e.g.</em> <code>OperationalProfile</code>.</p><div class="admonition is-danger"><header class="admonition-header">Varying storage capacities with Batteries</header><div class="admonition-body"><p>If you use batteries with varying capacities, it is important to implement one battery node for each investment period. The key reason is that the use is not calculated based on changing capacities. Similarly, if you plan to use batteries in investment models, it is necessary to specify one battery node for each investment periods with limited investments in an investment period.</p></div></div><h3 id="nodes-battery-phil-reserve"><a class="docs-heading-anchor" href="#nodes-battery-phil-reserve">Philosophy of <code>ReserveBattery</code></a><a id="nodes-battery-phil-reserve-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-phil-reserve" title="Permalink"></a></h3><p><a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> nodes allow modelling a system that requires reserve capacity. The reserve capacity must be specified as a sink with a demand for a given reserve resource and a potential penalty for violating the demand. The <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> is subsequently coupled to the link to satisfy the potential demand.</p><p>Reserve resources and demands are not included in the energy balances. Instead, they can be used to specify a minimum amount of dispatchable power to both increase either the electricity generation capacity or the electricity demand.</p><h2 id="nodes-battery-fields"><a class="docs-heading-anchor" href="#nodes-battery-fields">Introduced types and their fields</a><a id="nodes-battery-fields-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-fields" title="Permalink"></a></h2><p>The <a href="../../library/public/#EnergyModelsRenewableProducers.AbstractBattery"><code>AbstractBattery</code></a> abstract type is used to simplify the design of the constraints. It has in its current stage two concrete subtypes, <a href="../../library/public/#EnergyModelsRenewableProducers.Battery"><code>Battery</code></a> and <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a>. Both types utilize the same main functionality with respect to efficiencies and battery lifes. <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> is included as a first nodal type to be able to provide a reserve capacity for the energy system. This allows the user to specify a minimum of required reserve capacity at each individual operational period.</p><p>The two nodes are designed to work with the cyclic <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_behav">storage behaviors</a></em>. In practice, battery storages should utilize <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicRepresentative"><code>CyclicRepresentative</code></a> as battery storage is in general not considered for seasonal energy storage.</p><h3 id="nodes-battery-fields-stand"><a class="docs-heading-anchor" href="#nodes-battery-fields-stand">Standard fields</a><a id="nodes-battery-fields-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-fields-stand" title="Permalink"></a></h3><p>The standard fields are given as:</p><ul><li><strong><code>id</code></strong>:<br/>The field <code>id</code> is only used for providing a name to the node. This is similar to the approach utilized in <code>EnergyModelsBase</code>.</li><li><strong><code>charge::EMB.UnionCapacity</code></strong>:<br/>The charge storage parameters must include a capacity. The charge capacity is the capacity <strong>before</strong> taking into account the charging efficiency from the viewpoint of the storage level. This is also shown in the section on the <em><a href="#nodes-battery-math-con-add-level">level constraints</a></em> More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.</li><li><strong><code>level::EMB.UnionCapacity</code></strong>:<br/>The level storage parameters must include a capacity. More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.</li><li><strong><code>discharge::EMB.UnionCapacity</code></strong>:<br/>The discharge storage parameters must include a capacity. The discharge capacity is the capacity <strong>after</strong> taking into account the discharging efficiency from the viewpoint of the storage level. This is also shown in the section on the <em><a href="#nodes-battery-math-con-add-level">level constraints</a></em> More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.<div class="admonition is-info"><header class="admonition-header">Permitted values for storage parameters in `charge`, `level`, and `discharge`</header><div class="admonition-body"><p>If the node should contain investments through the application of <a href="https:// energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a>, it is important to note that you can only use <code>FixedProfile</code> or <code>StrategicProfile</code> for the capacity, but not <code>RepresentativeProfile</code> or <code>OperationalProfile</code>. Similarly, you can only use <code>FixedProfile</code> or <code>StrategicProfile</code> for the fixed OPEX, but not <code>RepresentativeProfile</code> or <code>OperationalProfile</code>. The variable operating expenses can be provided as <code>OperationalProfile</code> as well. In addition, all capacity and fixed OPEX values have to be non-negative.</p></div></div></li><li><strong><code>stor_res::ResourceEmit</code></strong>:<br/>The <code>stor_res</code> is the stored <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a>. In the case of a battery, you must specifiy your <em>electricity</em> resource.</li><li><strong><code>input::Dict{&lt;:Resource, &lt;:Real}</code></strong> and <strong><code>output::Dict{&lt;:Resource, &lt;:Real}</code></strong>:<br/>Both fields describe the <code>input</code> and <code>output</code> <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a>s with their corresponding conversion factors as dictionaries. The values correspond to charge and discharge efficiencies from the <code>AbstractBattery</code> nodes.<br/>All values have to be in the range <span>$[0, 1]$</span>.</li><li><strong><code>data::Vector{Data}</code></strong>:<br/>An entry for providing additional data to the model. In the current version, it is only relevant for additional investment data when <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a> is used.</li></ul><h3 id="nodes-battery-fields-new"><a class="docs-heading-anchor" href="#nodes-battery-fields-new">Additional fields</a><a id="nodes-battery-fields-new-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-fields-new" title="Permalink"></a></h3><p><a href="../../library/public/#EnergyModelsRenewableProducers.AbstractBattery"><code>AbstractBattery</code></a> nodes add additional fields compared to <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> nodes. These fields are located below the field <code>output</code> and before the field <code>data</code>.</p><p>The individual fields are related to specifics of batteries. These fields are given as:</p><ul><li><strong><code>battery_life::AbstractBatteryLife</code></strong>:<br/>The battery life is incorporated to include the potential for either battery type to include battery storage degradation. It is explained in more detail <em><a href="#nodes-battery-phil-life">above</a></em>.</li><li><strong><code>reserve_up::Vector{&lt;:ResourceCarrier}</code></strong>:<br/>The upwards reserve is only included for <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> nodes. It corresponds to the potential of the node to <em>deliver</em> reserve electricity to the system in the given operational period.<br/>The specified resources cannot be part of the <code>input</code> or <code>output</code> dictionaries.</li><li><strong><code>reserve_down::Vector{&lt;:ResourceCarrier}</code></strong>:<br/>The downwards reserve is only included for <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> nodes. It corresponds to the potential of the node to <em>receive</em> reserve electricity from the system in the given operational period.<br/>The specified resources cannot be part of the <code>input</code> or <code>output</code> dictionaries.</li></ul><h2 id="nodes-battery-math"><a class="docs-heading-anchor" href="#nodes-battery-math">Mathematical description</a><a id="nodes-battery-math-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math" title="Permalink"></a></h2><p>In the following mathematical equations, we use the name for variables and functions used in the model. Variables are in general represented as</p><p><span>$\texttt{var\_example}[index_1, index_2]$</span></p><p>with square brackets, while functions are represented as</p><p><span>$func\_example(index_1, index_2)$</span></p><p>with paranthesis.</p><h3 id="nodes-battery-math-var"><a class="docs-heading-anchor" href="#nodes-battery-math-var">Variables</a><a id="nodes-battery-math-var-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-var" title="Permalink"></a></h3><h4 id="nodes-battery-math-var-stand"><a class="docs-heading-anchor" href="#nodes-battery-math-var-stand">Standard variables</a><a id="nodes-battery-math-var-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-var-stand" title="Permalink"></a></h4><p>The battery node types utilize all standard variables from <code>RefStorage</code>, as described on the page <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var">Optimization variables</a></em>. The variables include:</p><ul><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-opex"><span>$\texttt{opex\_var}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-opex"><span>$\texttt{opex\_fixed}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_charge\_use}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_charge\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_discharge\_use}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_discharge\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-flow"><span>$\texttt{flow\_in}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-flow"><span>$\texttt{flow\_out}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_Δ\_op}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_Δ\_rp}$</span></a> if the <code>TimeStruct</code> includes <code>RepresentativePeriods</code></li></ul><h4 id="nodes-battery-math-add"><a class="docs-heading-anchor" href="#nodes-battery-math-add">Additional variables</a><a id="nodes-battery-math-add-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-add" title="Permalink"></a></h4><p><a href="../../library/public/#EnergyModelsRenewableProducers.AbstractBattery"><code>AbstractBattery</code></a> nodes by default calculate the charging of a battery in the individual periods, even if the battery life is modelled as <a href="../../library/public/#EnergyModelsRenewableProducers.InfLife"><code>InfLife</code></a> Hence, the following additional variables are included through providing a new methods to <a href="../../library/internals/methods-EMB/#EnergyModelsBase.variables_node"><code>EnergyModelsBase.variables_node()</code></a>:</p><ul><li><span>$\texttt{bat\_prev\_use}[n, t]$</span>: Previous charging of battery <span>$n$</span> at the beginning of operational period <span>$t$</span> with a typical unit of MWh.<br/>The previous use corresponds to how much the battery is charged up to the current operational period. It is utilized for calculating the degradation of the battery.</li><li><span>$\texttt{bat\_prev\_use\_sp}[n, t_{inv}]$</span>: Previous charging of battery <span>$n$</span> at the beginning of investmet period <span>$t_{inv}$</span> with a typical unit of MWh.<br/>The previous use corresponds to how much the battery is charged up to the current investment period. It is utilized for calculating the degradation of the battery.</li><li><span>$\texttt{bat\_use\_sp}[n, t_{inv}]$</span>: Charging of battery <span>$n$</span> in investment period <span>$t_{inv}$</span> with a typical unit of MWh.<br/>The use allows to see how many charging cycles are conducted within an investment period. It is utilized for calculating the degradation of the battery.</li><li><span>$\texttt{bat\_use\_rp}[n, t_{rp}]$</span>: Charging of battery <span>$n$</span> in representantive period <span>$t_{rp}$</span> with a typical unit of MWh.<br/>The use allows to see how many charging cycles are conducted within a representative period. It is utilized for calculating the degradation of the battery.<br/>It is only created if the time structure includes representative periods.</li><li><span>$\texttt{bat\_stack\_replace\_b}[n, t_{inv}]$</span>: Binary variable representing replacement of the battery stack.<br/>The battery stack replacement is occuring at the beginning of an investment period and results in setting the previous use to 0. Consequently, the initial capacity is available again.<br/>It is only created for battery nodes with <a href="../../library/public/#EnergyModelsRenewableProducers.CycleLife"><code>CycleLife</code></a>.</li></ul><p><a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> nodes create two additional variables:</p><ul><li><span>$\texttt{bat\_res\_up}[n, t]$</span>: Available upwards reserve of battery <span>$n$</span> in operational period <span>$t$</span> with a typical unit of MW.<br/>The upwards reserve corresponds to the potential of the battery to provide additional capacity to the system. The capacity is required to be sufficient for a duration of 1 of an operational period as outlined in <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/how-to/utilize-timestruct/#how_to-utilize_TS">Utilize <code>TimeStruct</code></a></em>.</li><li><span>$\texttt{bat\_res\_down}[n, t]$</span>: Available downwards reserve of battery <span>$n$</span> in operational period <span>$t$</span> with a typical unit of MW.<br/>The downwards reserve corresponds to the potential of the battery to use surplus capacity in the system for charging the battery. The capacity is required to be sufficient for a duration of 1 of an operational period as outlined in <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/how-to/utilize-timestruct/#how_to-utilize_TS">Utilize <code>TimeStruct</code></a></em>.</li></ul><h3 id="nodes-battery-math-con"><a class="docs-heading-anchor" href="#nodes-battery-math-con">Constraints</a><a id="nodes-battery-math-con-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-con" title="Permalink"></a></h3><p>The following sections omit the direct inclusion of the vector of battery storage nodes. Instead, it is implicitly assumed that the constraints are valid <span>$\forall n ∈ N$</span> for all <a href="../../library/public/#EnergyModelsRenewableProducers.Battery"><code>Battery</code></a> or <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> types if not stated differently. In addition, all constraints are valid <span>$\forall t \in T$</span> (that is in all operational periods) or <span>$\forall t_{inv} \in T^{Inv}$</span> (that is in all investment periods).</p><h4 id="nodes-battery-math-con-stand"><a class="docs-heading-anchor" href="#nodes-battery-math-con-stand">Standard constraints</a><a id="nodes-battery-math-con-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-con-stand" title="Permalink"></a></h4><p>Battery storages nodes utilize in general the standard constraints described on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/constraint-functions/#man-con">Constraint functions</a></em> for <code>RefStorage</code> nodes.</p><p>These standard constraints are:</p><ul><li><p><code>constraints_capacity_installed</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_inst}[n, t] &amp; = capacity(level(n), t) \\
\texttt{stor\_charge\_inst}[n, t] &amp; = capacity(charge(n), t) \\
\texttt{stor\_discharge\_inst}[n, t] &amp; = capacity(charge(n), t)
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">Using investments</header><div class="admonition-body"><p>The function <code>constraints_capacity_installed</code> is also used in <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a> to incorporate the potential for investment. Nodes with investments are then no longer constrained by the parameter capacity.</p></div></div></li><li><p><code>constraints_flow_in</code>:<br/>The auxiliary resource constraints are independent of the chosen storage behavior:</p><p class="math-container">\[\texttt{flow\_in}[n, t, p] = inputs(n, p) \times \texttt{flow\_in}[n, stor\_res(n)]
\qquad \forall p \in inputs(n) \setminus \{stor\_res(n)\}\]</p><p>The stored resource constraints are depending on the chosen storage behavior. it is given by</p><p class="math-container">\[\texttt{flow\_in}[n, t, stor\_res(n)] = \texttt{stor\_charge\_use}[n, t]\]</p></li><li><p><code>constraints_level</code>: The level constraints are in general following the default approach with minor modifications. They are explained in detail below in <em><a href="#nodes-battery-math-con-add-level">Level constraints</a></em></p></li><li><p><code>constraints_opex_var</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{opex\_var}&amp;[n, t_{inv}] = \\ \sum_{t \in t_{inv}}&amp;
  opex\_var(level(n), t) \times \texttt{stor\_level}[n, t] \times scale\_op\_sp(t_{inv}, t) + \\ &amp;
  opex\_var(charge(n), t) \times \texttt{stor\_charge\_use}[n, t] \times scale\_op\_sp(t_{inv}, t) + \\ &amp;
  opex\_var(discharge(n), t) \times \texttt{stor\_discharge\_use}[n, t] \times scale\_op\_sp(t_{inv}, t)
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">The function `scale_op_sp`</header><div class="admonition-body"><p>The function <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/functions/#EnergyModelsBase.scale_op_sp"><span>$scale\_op\_sp(t_{inv}, t)$</span></a> calculates the scaling factor between operational and investment periods. It also takes into account potential operational scenarios and their probability as well as representative periods.</p></div></div></li><li><p><code>constraints_data</code>:<br/>This function is only called for specified data of the CO₂ storage node, see above.</p></li></ul><div class="admonition is-info"><header class="admonition-header">Implementation of OPEX</header><div class="admonition-body"><p>The fixed and variable OPEX constribubtion for the charge, the level, and the discharge capacities are only included if the corresponding <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em> have a field <code>opex_fixed</code> and <code>opex_var</code>, respectively. Otherwise, they are omitted.</p></div></div><p>Batteries require a new method for <code>constraints_capacity</code>. While the charge and discharge capacities are unaffected by the storage level degradation,</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_charge\_inst}[n, t] &amp; \geq \texttt{stor\_charge\_use}[n, t] \\
\texttt{stor\_discharge\_inst}[n, t] &amp; \geq \texttt{stor\_discharge\_use}[n, t] \\
\end{aligned}\]</p><p>is is impacting the storage level capacity. If the node utilizes <a href="../../library/public/#EnergyModelsRenewableProducers.InfLife"><code>InfLife</code></a>, the function reverts to the default behavior given by</p><p class="math-container">\[\texttt{stor\_level\_inst}[n, t]  \geq \texttt{stor\_level}[n, t] \\\]</p><p>However, if the node utilizes <a href="../../library/public/#EnergyModelsRenewableProducers.CycleLife"><code>CycleLife</code></a>, we have to include battery degradation through</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_inst}[n, t] - &amp; degradation(n) \times \texttt{bat\_prev\_use}[n, t] / cycles(n) \\ &amp;
  \geq \texttt{stor\_level}[n, t]
\end{aligned}\]</p><p>The degradation corresponds to a linear degradation between a fresh battery with 0 cycles and a worn out battery at the maximum nubmer of cycles. It is implemented through the function <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.capacity_reduction"><code>capacity_reduction</code></a>.</p><p>The outlet flow of a <a href="../../library/public/#EnergyModelsRenewableProducers.Battery"><code>Battery</code></a> node is similar to a <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> node. It is reusing the functionality of the function <code>constraints_flow_out</code> for <code>Storage</code> nodes given by</p><p class="math-container">\[\texttt{flow\_out}[n, t, stor\_res(n)] = \texttt{stor\_discharge\_use}[n, t]\]</p><p><a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> nodes include a new method to also include the outflow of the reserve resources. This outflow does <strong>not</strong> correspond to a physical flow of energy or mass. Instead, it is purely utilized for accounting purposes.</p><p>The provided reserve for the specified reserve resources <span>$P^{up} = reserve\_up(n)$</span> and <span>$P^{down} = reserve\_down(n)$</span> is given by</p><p class="math-container">\[\begin{aligned}
\texttt{bat\_res\_up}[n, t] &amp; = \sum_{p \in P^{up}} \texttt{flow\_out}[n, t, p] \\
\texttt{bat\_res\_down}[n, t] &amp; \sum_{p \in P^{down}} \texttt{flow\_out}[n, t, p] \\
\end{aligned}\]</p><p>The fixed operating expenditures, calculated through the function <code>constraints_opex_fixed</code>, requires a new method to include the costs for the battery stack replacement. It first creates an auxiliary variable <span>$stack\_replace$</span> which is given as</p><p class="math-container">\[stack\_replace[t_{inv}] = stor\_level\_current[n, t_{inv}] \times bat\_stack\_replace\_b[n, t_{inv}]\]</p><p>if the battery includes investment options or</p><p class="math-container">\[stack\_replace[t_{inv}] = capacity(level(n), t_{inv}) \times bat\_stack\_replace\_b[n, t_{inv}]\]</p><p>if the battery does not include investments. The bilinearity is reformulated using the function <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.linear_reformulation"><code>linear_reformulation</code></a>. This auxiliary variable is subsequently utilized in the calculation of the</p><p class="math-container">\[\begin{aligned}
\texttt{opex\_fixed}&amp;[n, t_{inv}] = \\ &amp;
  opex\_fixed(level(n), t_{inv}) \times \texttt{stor\_level\_inst}[n, first(t_{inv})] + \\ &amp;
  opex\_fixed(charge(n), t_{inv}) \times \texttt{stor\_charge\_inst}[n, first(t_{inv})] + \\ &amp;
  opex\_fixed(discharge(n), t_{inv}) \times \texttt{stor\_discharge\_inst}[n, first(t_{inv})] + \\ &amp;
  stack\_cost(n) \times stack\_replace[t_{inv}] / duration\_strat(t_{inv})
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">Why do we divide by `duration_strat(t_inv)`</header><div class="admonition-body"><p>Stack replace occurs always at the beginning of an investment period <span>$t_{inv}$</span> and only once in an investment period. The variable <span>$\texttt{opex\_fixed}[n, t_{inv}]$</span> is multiplied in the objective function with <span>$duration\_strat(t_{inv})$</span>. As a consequence, if the duration of the investment period is larger than 1, we would invest multiple times into a new stack. Consequently, we have to divide the costs by the duration of the investment period.</p></div></div><div class="admonition is-success"><header class="admonition-header">Why do we use `first()`</header><div class="admonition-body"><p>The variables <span>$\texttt{stor\_level\_inst}$</span> are declared over all operational periods (see the section on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap">Capacity variables</a></em> for further explanations). Hence, we use the function <span>$first(t_{inv})$</span> to retrieve the installed capacities in the first operational period of a given investment period <span>$t_{inv}$</span> in the function <code>constraints_opex_fixed</code>.</p></div></div><h4 id="nodes-battery-math-con-add"><a class="docs-heading-anchor" href="#nodes-battery-math-con-add">Additional constraints</a><a id="nodes-battery-math-con-add-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-con-add" title="Permalink"></a></h4><h5 id="nodes-battery-math-con-add-use"><a class="docs-heading-anchor" href="#nodes-battery-math-con-add-use">Battery use constraints</a><a id="nodes-battery-math-con-add-use-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-con-add-use" title="Permalink"></a></h5><p>The calculation of the previous battery use requires the definition of new constraint functions as the approach differs depending on the chosen <code>TimeStructure</code>. The overall approach is similar to the calculation of the level constraints in <code>EnergyModelsBase</code>. The core function is <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.constraints_usage"><code>constraints_usage</code></a> from which the individual iteration is achieved.</p><p>Within this function, we first calculate <span>$\forall t_{inv} \in T^{Inv}$</span> the use of a battery within each investment period:</p><p class="math-container">\[\begin{aligned}
\texttt{bat\_use\_sp}[n, t_{inv}] = \sum_{t \in t_{inv}} &amp; \texttt{stor\_charge\_use}[n, t] \times \\ &amp;
  inputs(n, p_{stor}) \times scale\_op\_sp(t_{inv}, t) \\
\end{aligned}\]</p><p>In addition, we calculate the charging of the storage up to the current investment period <span>$t_{inv}$</span> through the subfunction <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.constraints_usage_sp"><code>constraints_usage_sp</code></a>. This function has two distinctive methods:</p><ol><li><p>If the current investment period is the first, we add the following constraint:</p><p class="math-container">\[\texttt{bat\_prev\_use\_sp}[n, t_{inv}] = 0\]</p></li><li><p>In all other investment periods it is given by</p><p class="math-container">\[\texttt{bat\_prev\_use\_sp}[n, t_{inv}] = \texttt{disjunct}[t_{inv}]\]</p><p>in which we introduce an auxiliary variable <span>$\texttt{disjunct}[t_{inv}]$</span>. The meaning of the auxiliary variable is depending on the chosen battery life type. For all <a href="../../library/internals/types-EMRP/#EnergyModelsRenewableProducers.AbstractBatteryLife"><code>AbstractBatteryLife</code></a>, if not specified differently, it is simply given as:</p><p class="math-container">\[\begin{aligned}
\texttt{disjunct}[t_{inv}] = &amp; \texttt{bat\_prev\_use\_sp}[n, t_{inv, prev}] + \\ &amp;
  \texttt{bat\_use\_sp}[n, t_{inv}] \times duration\_strat(t_{inv, prev}) \\
\end{aligned}\]</p><p>we have to include a bilinear term:</p><p class="math-container">\[\begin{aligned}
\texttt{disjunct}[t_{inv}] = &amp; ( \texttt{bat\_prev\_use\_sp}[n, t_{inv, prev}] + \\ &amp;
  \texttt{bat\_use\_sp}[n, t_{inv}] \times duration\_strat(t_{inv, prev}) ) \times \\ &amp;
  \texttt{bat\_stack\_replace\_n}[n, t_{inv}] \\
\end{aligned}\]</p><p>which is reformulated within the function directly. The differentiation is achieved through the subfunction <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.replace_disjunct"><code>replace_disjunct</code></a>.</p></li></ol><p>The function subsequently calls the function <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.constraints_usage_iterate"><code>constraints_usage_iterate</code></a> which iterates through the time structure and adds relevant constraints.</p><p>If the <code>TimeStructure</code> includes representative periods, then the use in each representative period <span>$t_{rp}$</span> is calculated (in the function <code>constraints_usage_iterate</code>):</p><p class="math-container">\[\begin{aligned}
\texttt{bat\_use\_rp}[n, t_{rp}] = \sum_{t \in t_{rp}} &amp; \texttt{stor\_charge\_use}[n, t] \times \\ &amp;
  inputs(n, p_{stor}) \times scale\_op\_sp(t_{rp}, t) \\
\end{aligned}\]</p><p>Once we reach the lowest time structure, <em>i.e.</em>, <code>SimpleTimes</code>, we enforce in the case of <a href="../../library/public/#EnergyModelsRenewableProducers.CycleLife"><code>CycleLife</code></a> the upper bound on the number of cycles of the battery for the last operational period <span>$t$</span> (in the last representative period for each operational scenario, if used) of an investment period as:</p><p class="math-container">\[\begin{aligned}
cycles(n) \times &amp; \texttt{stor\_level\_inst}[n, t] \geq \\ &amp;
  \texttt{bat\_prev\_use}[n, t] + \texttt{bat\_use\_sp}[n, t_{inv}] \times duration\_strat(t_{inv, prev}) \\
\end{aligned}\]</p><p>The declaration of the actual constraint for the previous use utilises the helper variable <span>$prev\_use$</span> in the following constraint:</p><p class="math-container">\[\begin{aligned}
\texttt{bat\_}&amp;\texttt{prev\_use}[n, t] = \\ &amp;
 prev\_use[t] + \\ &amp;
\texttt{stor\_charge\_use}[n, t] \times \\ &amp;
  inputs(n, p_{stor}) \times duration(t) \\ &amp;
\end{aligned}\]</p><p>The individual value of the auxiliary variable <span>$prev\_use$</span> can be differentiated in three individual cases:</p><ol><li><p>In the first operational period (in the first representative period) in investment periods:<br/>The constraint is given as</p><p class="math-container">\[prev\_use[t] = \texttt{bat\_prev\_use\_sp}[n, t_{inv}]\]</p><p>with <span>$t_{inv, pre} &lt; t_{inv}$</span>.</p></li><li><p>In the first operational period in subsequent representative periods:<br/>The constraint is given as</p><p class="math-container">\[\begin{aligned}
prev\_use[t] = &amp; \texttt{bat\_prev\_use}[n, first(t_{rp,prev})] - \\ &amp;
  \texttt{stor\_charge\_use}[n, first(t_{rp,prev})] \times \\ &amp;
  inputs(n, p_{stor}) \times duration(first(t_{rp,prev})) + \\ &amp;
\texttt{bat\_use\_rp}[n, t_{rp,prev}] \\
\end{aligned}\]</p><p>with <span>$t_{rp,prev}$</span> denoting the previous representative period. The subtraction is necessary as the use is calculated at the end of a period.</p></li><li><p>In all other operational periods</p><p class="math-container">\[prev\_use[t] = \texttt{bat\_prev\_use}[n, t_{prev}]\]</p><p>with <span>$t_{prev}$</span> denoting the previous operational period.</p></li></ol><p>Note, that the auxiliary variable is not directly implemented. Instead, the JuMP macro <code>@expression</code> is utilized.</p><h5 id="nodes-battery-math-con-add-reserve"><a class="docs-heading-anchor" href="#nodes-battery-math-con-add-reserve">Reserve constraints</a><a id="nodes-battery-math-con-add-reserve-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-con-add-reserve" title="Permalink"></a></h5><p>The reserve requires new constraints for calculating the potential of the <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> to provide reserve capacity. This is achieved through the function <a href="../../library/internals/methods-EMRP/#EnergyModelsRenewableProducers.constraints_reserve"><code>constraints_reserve</code></a> called from the <code>create_node</code> function.</p><p>A standard <a href="../../library/public/#EnergyModelsRenewableProducers.AbstractBattery"><code>AbstractBattery</code></a> node does not add any constraints when calling the function. A <a href="../../library/public/#EnergyModelsRenewableProducers.ReserveBattery"><code>ReserveBattery</code></a> adds the following additional constraints for specifying the available upwards reserve:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_discharge\_use}[n, t] - &amp; \texttt{stor\_charge\_use}[n, t] \leq \\ &amp;
  \texttt{stor\_discharge\_inst}[n, t] - \texttt{bat\_res\_up}[n, t] \\
\texttt{stor\_level}[n, t] - &amp; \texttt{bat\_res\_up}[n, t] \geq 0 \\
\end{aligned}\]</p><p>and downwards reserve:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_charge\_use}[n, t] - &amp; \texttt{stor\_discharge\_use}[n, t] \leq \\ &amp;
  \texttt{stor\_charge\_inst}[n, t] - \texttt{bat\_res\_down}[n, t] \\
\texttt{stor\_level}[n, t] + &amp; \texttt{bat\_res\_down}[n, t] \leq \\ &amp;
  \texttt{stor\_level\_inst}[n, t] - \\ &amp;
    degradation(n) \times \texttt{bat\_prev\_use}[n, t] / cycles(n) \\
\end{aligned}\]</p><p>The second constraint is replaced by</p><p class="math-container">\[\texttt{stor\_level}[n, t] + \texttt{bat\_res\_down}[n, t] \leq \texttt{stor\_level\_inst}[n, t]\]</p><p>if the node uses <a href="../../library/public/#EnergyModelsRenewableProducers.InfLife"><code>InfLife</code></a>, and hence, does not include battery degradation.</p><div class="admonition is-info"><header class="admonition-header">Required time for providing the reserve</header><div class="admonition-body"><p>As can be seens from above constraints, it is necessary to provide the reserve capacity for at least a duration of 1 of an operational period. If you use hourly resolution, it corresponds to an hour, even if the duration of the representative periods is longer (specified through a value differeing from 1 in the time structure). This concept is explained in the section <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/how-to/utilize-timestruct/#how_to-utilize_TS">utilize <code>TimeStruct</code></a></em>.</p></div></div><h5 id="nodes-battery-math-con-add-level"><a class="docs-heading-anchor" href="#nodes-battery-math-con-add-level">Level constraints</a><a id="nodes-battery-math-con-add-level-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-battery-math-con-add-level" title="Permalink"></a></h5><p>The level constraints are in general slightly more complex to understand. The overall structure is outlined on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/constraint-functions/#man-con-stor_level">Constraint functions</a></em>. The level constraints are called through the function <code>constraints_level</code> which then calls additional functions depending on the chosen time structure (whether it includes representative periods and/or operational scenarios) and the chosen <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_behav">storage behaviour</a></em>.</p><p>The battery nodes utilize the majority of the concepts from <code>EnergyModelsBase</code> but require adjustments for both constraining the variable <span>$\texttt{stor\_level\_Δ\_op}$</span> and specifying how the storage node has to behave in the first operational period of an investment period. This is achieved through dispatching on the functions <code>constraints_level_aux</code>.</p><p>The constraints introduced in <code>constraints_level_aux</code> are given by the energy balance with <span>$p_{stor}$</span> corresponding to the stored resource:</p><p class="math-container">\[\begin{aligned}
  \texttt{stor\_level\_Δ\_op}&amp;[n, t] = \\ &amp;
  \texttt{stor\_charge\_use}[n, t] \times inputs(n, p_{stor}) - \\ &amp;
  \texttt{stor\_discharge\_use}[n, t] / outputs(n, p_{stor})
\end{aligned}\]</p><p>If the time structure includes representative periods, we also calculate the change of the storage level in each representative period within the function <code>constraints_level_iterate</code> (from <code>EnergyModelsBase</code>):</p><p class="math-container">\[  \texttt{stor\_level\_Δ\_rp}[n, t_{rp}] = \sum_{t \in t_{rp}}
  \texttt{stor\_level\_Δ\_op}[n, t] \times scale\_op\_sp(t_{inv}, t)\]</p><p>The general level constraint is calculated in the function <code>constraints_level_iterate</code> (from <code>EnergyModelsBase</code>):</p><p class="math-container">\[\texttt{stor\_level}[n, t] = prev\_level +
\texttt{stor\_level\_Δ\_op}[n, t] \times duration(t)\]</p><p>in which the value <span>$prev\_level$</span> is depending on the type of the previous operational (<span>$t_{prev}$</span>) and investment period (<span>$t_{inv,prev}$</span>) (as well as the previous representative period (<span>$t_{rp,prev}$</span>)). It is calculated through the function <code>previous_level</code>.</p><p>In the case of battery nodes, we can distinguish the following cases:</p><ol><li><p>The first operational period in the first representative period in any investment period (given by <span>$typeof(t_{prev}) = typeof(t_{rp, prev})$</span> and <span>$typeof(t_{inv,prev}) = NothingPeriod$</span>). In this situation, we can distinguish three cases, the time structure does not include representative periods:</p><p class="math-container">\[prev\_level = \texttt{stor\_level}[n, last(t_{inv})]\]</p><p>the time structure includes representative periods and the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicRepresentative"><code>CyclicRepresentative</code></a>:</p><p class="math-container">\[prev\_level = \texttt{stor\_level}[n, last(t_{rp})]\]</p><p>the time structure includes representative periods and the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicStrategic"><code>CyclicStrategic</code></a>:</p><p class="math-container">\[\begin{aligned}
 prev\_level = &amp; \texttt{stor\_level}[n, first(t_{rp,last})] - \\ &amp;
   \texttt{stor\_level\_Δ\_op}[n, first(t_{rp,last})] \times duration(first(t_{rp,last})) + \\ &amp;
   \texttt{stor\_level\_Δ\_rp}[n, t_{rp,last}] \times duration\_strat(t_{rp,last})
\end{aligned}\]</p></li><li><p>The first operational period in subsequent representative periods in any investment period (given by <span>$typeof(t_{prev}) = nothing$</span>) if the the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicStrategic"><code>CyclicStrategic</code></a>:<br/></p><p class="math-container">\[\begin{aligned}
 prev\_level = &amp; \texttt{stor\_level}[n, first(t_{rp,prev})] - \\ &amp;
   \texttt{stor\_level\_Δ\_op}[n, first(t_{rp,prev})] \times duration(first(t_{rp,prev})) + \\ &amp;
   \texttt{stor\_level\_Δ\_rp}[n, t_{rp,prev}]
\end{aligned}\]</p><p>This situation only occurs in cases in which the time structure includes representative periods.</p></li><li><p>All other operational periods:<br/></p><p class="math-container">\[ prev\_level = \texttt{stor\_level}[n, t_{prev}]\]</p></li></ol><p>All cases are implemented in <code>EnergyModelsBase</code> simplifying the design of the system.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../det_hydropower/gate/">« Hydro gate node</a><a class="docs-footer-nextpage" href="../../how-to/update-models/">Update models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 27 November 2024 15:04">Wednesday 27 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
