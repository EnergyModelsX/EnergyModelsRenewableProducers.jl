<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple Hydropower · EnergyModelsRenewableProducers</title><meta name="title" content="Simple Hydropower · EnergyModelsRenewableProducers"/><meta property="og:title" content="Simple Hydropower · EnergyModelsRenewableProducers"/><meta property="twitter:title" content="Simple Hydropower · EnergyModelsRenewableProducers"/><meta name="description" content="Documentation for EnergyModelsRenewableProducers."/><meta property="og:description" content="Documentation for EnergyModelsRenewableProducers."/><meta property="twitter:description" content="Documentation for EnergyModelsRenewableProducers."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnergyModelsRenewableProducers</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/quick-start/">Quick Start</a></li><li><a class="tocitem" href="../../manual/simple-example/">Examples</a></li><li><a class="tocitem" href="../../manual/NEWS/">Release notes</a></li></ul></li><li><span class="tocitem">Nodes</span><ul><li><a class="tocitem" href="../nondisres/">Non-dispatchable RES</a></li><li class="is-active"><a class="tocitem" href>Simple Hydropower</a><ul class="internal"><li><a class="tocitem" href="#nodes-hydro_power-fields"><span>Introduced types and their fields</span></a></li><li><a class="tocitem" href="#nodes-hydro_power-math"><span>Mathematical description</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Detailed hydropower</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../det_hydropower/description/">Detailed hydropower</a></li><li><a class="tocitem" href="../det_hydropower/reservoir/">Hydro reservoir node</a></li><li><a class="tocitem" href="../det_hydropower/generator/">Hydro generator node</a></li><li><a class="tocitem" href="../det_hydropower/pump/">Hydro pump node</a></li><li><a class="tocitem" href="../det_hydropower/gate/">Hydro gate node</a></li></ul></li><li><a class="tocitem" href="../battery/">Battery</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../how-to/update-models/">Update models</a></li><li><a class="tocitem" href="../../how-to/contribute/">Contribute to EnergyModelsRenewableProducers</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/internals/types-EMRP/">Types</a></li><li><a class="tocitem" href="../../library/internals/methods-fields/">Methods - Accessing fields</a></li><li><a class="tocitem" href="../../library/internals/methods-EMRP/">Methods - Internal</a></li><li><a class="tocitem" href="../../library/internals/methods-EMB/">Methods - <code>EnergyModelsBase</code></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Nodes</a></li><li class="is-active"><a href>Simple Hydropower</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple Hydropower</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsRenewableProducers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsRenewableProducers.jl/blob/main/docs/src/nodes/hydropower.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="nodes-hydro_power"><a class="docs-heading-anchor" href="#nodes-hydro_power">Hydro storage node</a><a id="nodes-hydro_power-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power" title="Permalink"></a></h1><p>The reference storage node, <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> is quite flexible with respect to the individual storage behaviours, that is cyclic (both representative and strategic) or accumulating as it is included as parametric type using the individual <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_behav">storage behaviours</a></em>. In addition, it allows for modelling charge and storage level as different <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>. It is, however, not possible at the moment to provide a discharge capacity required in hydropower modelling. Furthermore, it is not possible to include an inflow to the storage node, except through artifically creating a source node representing the water flowing into the node.</p><p>Hence, it is necessary to include a specific hydropower storage node.</p><h2 id="nodes-hydro_power-fields"><a class="docs-heading-anchor" href="#nodes-hydro_power-fields">Introduced types and their fields</a><a id="nodes-hydro_power-fields-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-fields" title="Permalink"></a></h2><p>The <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStorage"><code>HydroStorage</code></a> abstract type is used to simplify the design of the constraints. It has in its current stage two concrete subtypes, <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a> and <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a>. Both types utilize the same main functionality, although <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a> allows for utilizing electricity to store more water. The two nodes are designed to work with the cyclic <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_behav">storage behaviors</a></em>. <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a> and <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a> should mainly be used for aggregated hydropower descriptions.</p><div class="admonition is-warning"><header class="admonition-header">Input, output, and stored resource</header><div class="admonition-body"><p>Although hydro reservoir store water, we have to assume in the current implementation that electricity is stored. The key reason for this is that we do not support in the modelling approach a conversion from the variable <span>$\texttt{flow\_in}$</span> of a resource to a different stored resource.</p></div></div><p>For detailed hydropower modeling, see <em><a href="../det_hydropower/description/#nodes-det_hydro_power">Detailed hydropower</a></em>.</p><h3 id="nodes-hydro_power-fields-stand"><a class="docs-heading-anchor" href="#nodes-hydro_power-fields-stand">Standard fields</a><a id="nodes-hydro_power-fields-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-fields-stand" title="Permalink"></a></h3><p>The standard fields are given as:</p><ul><li><strong><code>id</code></strong>:<br/>The field <code>id</code> is only used for providing a name to the node. This is similar to the approach utilized in <code>EnergyModelsBase</code>.</li><li><strong><code>charge::EMB.UnionCapacity</code></strong>:<br/>The charge storage parameters must include a capacity. More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.<div class="admonition is-info"><header class="admonition-header">Meaning in boths nodes</header><div class="admonition-body"><p>The <code>charge</code> field is only included for <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a> nodes while <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a> do <strong>not</strong> allow for flow into the node.</p></div></div></li><li><strong><code>level::EMB.UnionCapacity</code></strong>:<br/>The level storage parameters must include a capacity. More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.</li><li><strong><code>discharge::EMB.UnionCapacity</code></strong>:<br/>The discharge storage parameters must include a capacity. More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.<div class="admonition is-info"><header class="admonition-header">Permitted values for storage parameters in `charge`, `level`, and `discharge`</header><div class="admonition-body"><p>If the node should contain investments through the application of <a href="https:// energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a>, it is important to note that you can only use <code>FixedProfile</code> or <code>StrategicProfile</code> for the capacity, but not <code>RepresentativeProfile</code> or <code>OperationalProfile</code>. Similarly, you can only use <code>FixedProfile</code> or <code>StrategicProfile</code> for the fixed OPEX, but not <code>RepresentativeProfile</code> or <code>OperationalProfile</code>. The variable operating expenses can be provided as <code>OperationalProfile</code> as well. In addition, all capacity and fixed OPEX values have to be non-negative.</p></div></div></li><li><strong><code>stor_res::ResourceEmit</code></strong>:<br/>The <code>stor_res</code> is the stored <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a>. The current implementation of <code>HydroStorage</code> nodes do not consider the conversion of potential energy of the stored water to electricity. Hence, you must specifiy your <em>electricity</em> resource.</li><li><strong><code>input::Dict{&lt;:Resource, &lt;:Real}</code></strong> and <strong><code>output::Dict{&lt;:Resource, &lt;:Real}</code></strong>:<br/>Both fields describe the <code>input</code> and <code>output</code> <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a>s with their corresponding conversion factors as dictionaries. The values correspond to charge and discharge efficiencies from the <code>HydroStorage</code> nodes.<br/>All values have to be in the range <span>$[0, 1]$</span>.</li><li><strong><code>data::Vector{Data}</code></strong>:<br/>An entry for providing additional data to the model. In the current version, it is only relevant for additional investment data when <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a> is used.</li></ul><h3 id="nodes-hydro_power-fields-new"><a class="docs-heading-anchor" href="#nodes-hydro_power-fields-new">Additional fields</a><a id="nodes-hydro_power-fields-new-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-fields-new" title="Permalink"></a></h3><p><a href="../../library/public/#EnergyModelsRenewableProducers.HydroStorage"><code>HydroStorage</code></a> nodes add additional fields compared to <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> nodes. These fields are located below the field <code>discharge</code>, and hence, correspond to the 4ᵗʰ to 6ᵗʰ fields of the node. As a consequence, <code>stor_res</code> is now the 7ᵗʰ field compared to being the 4ᵗʰ in a <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> node.</p><p>The individual fields are related to specifics of hydropower. These fields are given as:</p><ul><li><strong><code>level_init::TimeProfile</code></strong>:<br/>The initial level corresponds to the amount of <em>electricity</em> stored in the reservoir at the beginning of each strategic period. It can be provided as <code>OperationalProfile</code>. In practice, it is however sufficient to provide it as <code>StrategicProfile</code> as only a single value is used.<br/>The initial levels have to be non-negative and less than the maximum storage capacity.</li><li><strong><code>level_inflow::TimeProfile</code></strong>:<br/>The inflow is representing the potential <em>electricity</em> flowing into the reservoir in each operational period. It is depending on rivers flowing into the reservoir or rainfall. It can be provided as <code>OperationalProfile</code>.</li><li><strong><code>level_min::TimeProfile</code></strong>:<br/>The minimum level provides a lower bound on the usage of the storage node in each operational period. This lower bound can be enforced by regulators to maintain a minimum amount of available stored electricity. The current implementation does not allow for a violation of the constraint, although this can be implemented in a latter stage. It can be provided as <code>OperationalProfile</code>.<br/>The inflow has to be able in combination with the initial level to provide the required minimum level in the first operational period of each strategic period. In addition, all values have to be in the range <span>$[0, 1]$</span>.</li></ul><h2 id="nodes-hydro_power-math"><a class="docs-heading-anchor" href="#nodes-hydro_power-math">Mathematical description</a><a id="nodes-hydro_power-math-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math" title="Permalink"></a></h2><p>In the following mathematical equations, we use the name for variables and functions used in the model. Variables are in general represented as</p><p><span>$\texttt{var\_example}[index_1, index_2]$</span></p><p>with square brackets, while functions are represented as</p><p><span>$func\_example(index_1, index_2)$</span></p><p>with paranthesis.</p><h3 id="nodes-hydro_power-math-var"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-var">Variables</a><a id="nodes-hydro_power-math-var-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-var" title="Permalink"></a></h3><h4 id="nodes-hydro_power-math-var-stand"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-var-stand">Standard variables</a><a id="nodes-hydro_power-math-var-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-var-stand" title="Permalink"></a></h4><p>The hydro power node types utilize all standard variables from <code>RefStorage</code>, as described on the page <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var">Optimization variables</a></em>. The variables include:</p><ul><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-opex"><span>$\texttt{opex\_var}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-opex"><span>$\texttt{opex\_fixed}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_charge\_use}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_charge\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_discharge\_use}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_discharge\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-flow"><span>$\texttt{flow\_in}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-flow"><span>$\texttt{flow\_out}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_Δ\_op}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_Δ\_rp}$</span></a> if the <code>TimeStruct</code> includes <code>RepresentativePeriods</code></li></ul><p>The variables <span>$\texttt{flow\_in}$</span> and <span>$\texttt{stor\_charge\_use}$</span> are fixed to a value of 0 in the function <code>constraints_flow_in</code> for <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a> nodes as these nodes correspond to regulated hydropower plants and not pumped hydropower plants..</p><h4 id="nodes-hydro_power-math-add"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-add">Additional variables</a><a id="nodes-hydro_power-math-add-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-add" title="Permalink"></a></h4><p><a href="../../library/public/#EnergyModelsRenewableProducers.HydroStorage"><code>HydroStorage</code></a> nodes must allow for spillage of surplus stored water. Hence, a single additional variable is declared through dispatching on the method <a href="../../library/internals/methods-EMB/#EnergyModelsBase.variables_node"><code>EnergyModelsBase.variables_node()</code></a>:</p><ul><li><span>$\texttt{hydro\_spill}[n, t]$</span>: Spilled <em>electricity</em> in hydropower node <span>$n$</span> in operational period <span>$t$</span> with a typical unit of MW.<br/>The spillage in each operational period is a rate specifying how much <em>electricity</em> is spilled, that is not routed the the grid, but instead directed from the turbines to avoid overfilling the reservoir. It hence allows for an overflow from a reservoir if the inflow to a reservoir exceeds its capacity and the outflow through power generation.</li></ul><h3 id="nodes-hydro_power-math-con"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-con">Constraints</a><a id="nodes-hydro_power-math-con-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-con" title="Permalink"></a></h3><p>The following sections omit the direct inclusion of the vector of hydropower storage nodes. Instead, it is implicitly assumed that the constraints are valid <span>$\forall n ∈ N$</span> for all <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a> or <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a> types if not stated differently. In addition, all constraints are valid <span>$\forall t \in T$</span> (that is in all operational periods) or <span>$\forall t_{inv} \in T^{Inv}$</span> (that is in all strategic periods).</p><h4 id="nodes-hydro_power-math-con-stand"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-con-stand">Standard constraints</a><a id="nodes-hydro_power-math-con-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-con-stand" title="Permalink"></a></h4><p>Hydropower storages nodes utilize in general the standard constraints described on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/constraint-functions/#man-con">Constraint functions</a></em> for <code>RefStorage</code> nodes.</p><div class="admonition is-warning"><header class="admonition-header">stor_charge_xxx</header><div class="admonition-body"><p>The constraints for <span>$\texttt{stor\_charge\_use}$</span> are only implemented for <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a> nodes. This also includes the contribution to the variables <span>$\texttt{opex\_fixed}$</span> and <span>$\texttt{opex\_var}$</span>.</p></div></div><p>These standard constraints are:</p><ul><li><p><code>constraints_capacity</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_inst}[n, t] &amp; \geq \texttt{stor\_level}[n, t] \\
\texttt{stor\_charge\_inst}[n, t] &amp; \geq \texttt{stor\_charge\_use}[n, t] \\
\texttt{stor\_discharge\_inst}[n, t] &amp; \geq \texttt{stor\_discharge\_use}[n, t] \\
\end{aligned}\]</p></li><li><p><code>constraints_capacity_installed</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_inst}[n, t] &amp; = capacity(level(n), t) \\
\texttt{stor\_charge\_inst}[n, t] &amp; = capacity(charge(n), t) \\
\texttt{stor\_discharge\_inst}[n, t] &amp; = capacity(charge(n), t)
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">Using investments</header><div class="admonition-body"><p>The function <code>constraints_capacity_installed</code> is also used in <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a> to incorporate the potential for investment. Nodes with investments are then no longer constrained by the parameter capacity.</p></div></div></li><li><p><code>constraints_level</code>: The level constraints are in general following the default approach with minor modifications. They are explained in detail below in <em><a href="#nodes-hydro_power-math-con-add-level">Level constraints</a></em>.</p></li><li><p><code>constraints_opex_fixed</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{opex\_fixed}&amp;[n, t_{inv}] = \\ &amp;
  opex\_fixed(level(n), t_{inv}) \times \texttt{stor\_level\_inst}[n, first(t_{inv})] + \\ &amp;
  opex\_fixed(charge(n), t_{inv}) \times \texttt{stor\_charge\_inst}[n, first(t_{inv})] + \\ &amp;
  opex\_fixed(discharge(n), t_{inv}) \times \texttt{stor\_discharge\_inst}[n, first(t_{inv})]
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">Why do we use `first()`</header><div class="admonition-body"><p>The variables <span>$\texttt{stor\_level\_inst}$</span> are declared over all operational periods (see the section on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap">Capacity variables</a></em> for further explanations). Hence, we use the function <span>$first(t_{inv})$</span> to retrieve the installed capacities in the first operational period of a given strategic period <span>$t_{inv}$</span> in the function <code>constraints_opex_fixed</code>.</p></div></div></li><li><p><code>constraints_opex_var</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{opex\_var}&amp;[n, t_{inv}] = \\ \sum_{t \in t_{inv}}&amp;
  opex\_var(level(n), t) \times \texttt{stor\_level}[n, t] \times scale\_op\_sp(t_{inv}, t) + \\ &amp;
  opex\_var(charge(n), t) \times \texttt{stor\_charge\_use}[n, t] \times scale\_op\_sp(t_{inv}, t) + \\ &amp;
  opex\_var(discharge(n), t) \times \texttt{stor\_discharge\_use}[n, t] \times scale\_op\_sp(t_{inv}, t)
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">The function `scale_op_sp`</header><div class="admonition-body"><p>The function <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/functions/#EnergyModelsBase.scale_op_sp"><span>$scale\_op\_sp(t_{inv}, t)$</span></a> calculates the scaling factor between operational and strategic periods. It also takes into account potential operational scenarios and their probability as well as representative periods.</p></div></div></li><li><p><code>constraints_data</code>:<br/>This function is only called for specified data of the CO₂ storage node, see above.</p></li></ul><div class="admonition is-info"><header class="admonition-header">Implementation of OPEX</header><div class="admonition-body"><p>The fixed and variable OPEX constribubtion for the level and the charge capacities are only included if the corresponding <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em> have a field <code>opex_fixed</code> and <code>opex_var</code>, respectively. Otherwise, they are omitted.</p></div></div><p>The function <code>constraints_flow_in</code> is extended with a new method for hydropower nodes to differentiate whether the node is a pumped hydropower node or not. The standard constraints given by</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_inst}[n, t] &amp; \geq \texttt{stor\_level}[n, t] \\
\texttt{stor\_charge\_inst}[n, t] &amp; \geq \texttt{stor\_charge\_use}[n, t] \\
\end{aligned}\]</p><p>are extended with a constraint for <a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a> nodes given by</p><p class="math-container">\[\texttt{flow\_in}[n, t, p] \times inputs(n, p)  =
\texttt{stor\_charge\_use}[n, t]  \qquad \forall p \in inputs(n)\]</p><p>while the variables <span>$\texttt{flow\_in}$</span> and <span>$\texttt{stor\_charge\_use}$</span> are fixed to a value of 0 for <a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a> nodes.</p><p>These constraints allow either to include an efficiency for filling the reservoir (<a href="../../library/public/#EnergyModelsRenewableProducers.PumpedHydroStor"><code>PumpedHydroStor</code></a>) or avoiding unconstrained variables (<a href="../../library/public/#EnergyModelsRenewableProducers.HydroStor"><code>HydroStor</code></a>).</p><h4 id="nodes-hydro_power-math-con-add"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-con-add">Additional constraints</a><a id="nodes-hydro_power-math-con-add-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-con-add" title="Permalink"></a></h4><h5 id="nodes-hydro_power-math-con-add-node"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-con-add-node">Constraints calculated in <code>create_node</code></a><a id="nodes-hydro_power-math-con-add-node-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-con-add-node" title="Permalink"></a></h5><p>The outlet flow constraints are given as</p><p class="math-container">\[\texttt{flow\_out}[n, t, p] =
\texttt{stor\_charge\_use}[n, t] \times outputs(n, p) \qquad \forall p \in outputs(n)\]</p><p>As a consequence, similar to the inlet flow constraint, we can specify an efficiency between 0 and 1 to account for loses in the turbine.</p><p>In addition a constraint on the maximum discharge given by</p><p class="math-container">\[\texttt{stor\_discharge\_use}[n, t] \leq \texttt{stor\_level}[n, t]\]</p><p>is included to constrain the discharge further. This constraint is in practice not active as the storage level is bound at a lower bound provided through the field <code>level_min</code>.</p><h5 id="nodes-hydro_power-math-con-add-level"><a class="docs-heading-anchor" href="#nodes-hydro_power-math-con-add-level">Level constraints</a><a id="nodes-hydro_power-math-con-add-level-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-hydro_power-math-con-add-level" title="Permalink"></a></h5><p>The level constraints are in general slightly more complex to understand. The overall structure is outlined on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/constraint-functions/#man-con-stor_level">Constraint functions</a></em>. The level constraints are called through the function <code>constraints_level</code> which then calls additional functions depending on the chosen time structure (whether it includes representative periods and/or operational scenarios) and the chosen <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_behav">storage behaviour</a></em>.</p><p>The hydro power nodes utilize the majority of the concepts from <code>EnergyModelsBase</code> but require adjustments for both constraining the variable <span>$\texttt{stor\_level\_Δ\_op}$</span> and specifying how the storage node has to behave in the first operational period of a strategic period. This is achieved through dispatching on the functions <code>constraints_level_aux</code>.</p><p>The constraints introduced in <code>constraints_level_aux</code>  can be divided in three groups:</p><ol><li><p>the energy balance,</p><p class="math-container">\[\begin{aligned}
  \texttt{stor\_level\_Δ\_op}&amp;[n, t] = \\ &amp;
  level\_inflow(n, t) + \texttt{stor\_charge\_use}[n, t] - \\ &amp;
  \texttt{stor\_discharge\_use}[n, t] - \texttt{hydro\_spill}[n, t]
\end{aligned}\]</p></li><li><p>the initial storage level in the first operational period of a strategic period, and</p><p class="math-container">\[\begin{aligned}
  \texttt{stor\_level}&amp; [n, first(t_{inv})] = \\ &amp;
  level\_init(n, first(t_{inv})) + \\ &amp;
  \texttt{stor\_level\_Δ\_op}[n, first(t_{inv})] \times duration(first(t_{inv}))
\end{aligned}\]</p></li><li><p>the minimum level constraint</p><p class="math-container">\[\texttt{stor\_level}[n, t] \geq level\_min(n, t) \times \texttt{stor\_level\_inst}[n, t]\]</p></li></ol><p>corresponding to the change in the storage level in an operational period and strategic period, respectively.</p><p>If the time structure includes representative periods, we also calculate the change of the storage level in each representative period within the function <code>constraints_level_iterate</code> (from <code>EnergyModelsBase</code>):</p><p class="math-container">\[  \texttt{stor\_level\_Δ\_rp}[n, t_{rp}] = \sum_{t \in t_{rp}}
  \texttt{stor\_level\_Δ\_op}[n, t] \times scale\_op\_sp(t_{inv}, t)\]</p><p>The general level constraint is calculated in the function <code>constraints_level_iterate</code> (from <code>EnergyModelsBase</code>):</p><p class="math-container">\[\texttt{stor\_level}[n, t] = prev\_level +
\texttt{stor\_level\_Δ\_op}[n, t] \times duration(t)\]</p><p>in which the value <span>$prev\_level$</span> is depending on the type of the previous operational (<span>$t_{prev}$</span>) and strategic level (<span>$t_{inv,prev}$</span>) (as well as the previous representative period (<span>$t_{rp,prev}$</span>)). It is calculated through the function <code>previous_level</code>.</p><p>In the case of hydropower node, we can distinguish the following cases:</p><ol><li><p>The first operational period in the first representative period in any strategic period (given by <span>$typeof(t_{prev}) = typeof(t_{rp, prev})$</span> and <span>$typeof(t_{inv,prev}) = NothingPeriod$</span>). In this situation, we can distinguish three cases, the time structure does not include representative periods:</p><p class="math-container">\[prev\_level = \texttt{stor\_level}[n, last(t_{inv})]\]</p><p>the time structure includes representative periods and the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicRepresentative"><code>CyclicRepresentative</code></a>:</p><p class="math-container">\[prev\_level = \texttt{stor\_level}[n, last(t_{rp})]\]</p><p>the time structure includes representative periods and the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicStrategic"><code>CyclicStrategic</code></a>:</p><p class="math-container">\[\begin{aligned}
 prev\_level = &amp; \texttt{stor\_level}[n, first(t_{rp,last})] - \\ &amp;
   \texttt{stor\_level\_Δ\_op}[n, first(t_{rp,last})] \times duration(first(t_{rp,last})) + \\ &amp;
   \texttt{stor\_level\_Δ\_rp}[n, t_{rp,last}] \times duration\_strat(t_{rp,last})
\end{aligned}\]</p></li><li><p>The first operational period in subsequent representative periods in any strategic period (given by <span>$typeof(t_{prev}) = nothing$</span>) if the the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicStrategic"><code>CyclicStrategic</code></a>:<br/></p><p class="math-container">\[\begin{aligned}
 prev\_level = &amp; \texttt{stor\_level}[n, first(t_{rp,prev})] - \\ &amp;
   \texttt{stor\_level\_Δ\_op}[n, first(t_{rp,prev})] \times duration(first(t_{rp,prev})) + \\ &amp;
   \texttt{stor\_level\_Δ\_rp}[n, t_{rp,prev}]
\end{aligned}\]</p><p>This situation only occurs in cases in which the time structure includes representative periods.</p></li><li><p>All other operational periods:<br/></p><p class="math-container">\[ prev\_level = \texttt{stor\_level}[n, t_{prev}]\]</p></li></ol><p>All cases are implemented in <code>EnergyModelsBase</code> simplifying the design of the system.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../nondisres/">« Non-dispatchable RES</a><a class="docs-footer-nextpage" href="../det_hydropower/description/">Detailed hydropower »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 27 November 2024 14:29">Wednesday 27 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
